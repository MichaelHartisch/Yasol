/*
 *
 * Yasol: Yasol.cpp -- Copyright (c) 2012-2017 Ulf Lorenz
 *
 * Permission is hereby granted, free of charge, to any person obtaining a
 * copy of this software and associated documentation files (the
 * "Software"), to deal in the Software without restriction, including
 * without limitation the rights to use, copy, modify, merge, publish,
 * distribute, sublicense, and/or sell copies of the Software, and to
 * permit persons to whom the Software is furnished to do so, subject to
 * the following conditions:
 *
 * The above copyright notice and this permission notice shall be included
 * in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS
 * OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
 * MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
 * LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
 * OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
 * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

#ifndef NO_MPI
#include <mpi.h>
#else
#include "nomp.h"
void MPI_Init(int*, char***) {}

void MPI_Buffer_attach(void*,int) {}
void MPI_Comm_rank(int x, int*y) {*y = 0;}
void MPI_Comm_size(int x, int*y) {*y = 1;}
void MPI_Wait(MPI_Request *, MPI_Status*) {}
void MPI_Barrier(int) {}
void MPI_Finalize(void) {}
void MPI_Ibsend(void *, int, int , int, int, int, MPI_Request *) {}
void MPI_Isend(void *, int, int, int,int , int, MPI_Request *){}
void MPI_Irecv(void *, int , int , int , int , int, MPI_Request*) {}
void MPI_Iprobe(int a, int b, int c, int* d, MPI_Status* e) {*d = 0;}
void MPI_Test(MPI_Request* a, int *b, MPI_Status *c) {*b = 1;}
void MPI_Recv(void *buf, int count, int datatype, int source, int tag, int* comm, MPI_Status *status) {}
void MPI_Send(const void *buf, int count, int datatype, int dest, int tag, int* comm) {}
void MPI_Get_count(MPI_Status*c, int m, int*size) {}

#endif
#include <iostream>
#include <cstdlib>
using namespace std;
#include "yInterface.h"

/*
 *
 k_grz_p-6.qdimacs
 k_d4_p-5.qdimacs
 cnt10.qdimacs
 cnt11.qdimacs
 3qbf-5cnf-20var-640cl.1.qdimacs
 3qbf-5cnf-20var-640cl.2.qdimacs

*/

int main(int argc, char** argv) {

  int myrank=0;
  MPI_Status status;

  if( !(argc-1) ){
#ifndef SVN_REV
#define SVN_REV "unknown"
#endif
    std::cout << SVN_REV << std::endl;
    return 0;
  }
  MPI_Init(&argc,&argv);
  MPI_Comm_rank(MPI_COMM_WORLD, &myrank);

  //cerr << myrank << ": enter Yasol main." << endl;
  //utils::Logger::newLogger(&std::cout, utils::levelString(CONSOLE_LOG_LEVEL), "COUT");
  yInterface* yasolPt=new yInterface();
  yInterface& yasol = *yasolPt;
  coef_t result;
  time_t ini_time;
  //  if (myrank == 0) cerr << "Yasol" << endl; // prints Yasol

  std::string in = std::string(argv[1]);
  //std::string in = std::string("C:\\Users\\michaelhartisch\\Programme\\Yasol_Windows\\Data\\p0033.qip");
  if (myrank == 0) cerr << "reading " <<in << endl;
  if (argc > 2) {
    yasol.setInfoLevel(atoi(argv[2]));
  }
  //yasol.setInfoLevel(5);


  int DoneAfterSimplification=yasol.yInit(in);  
  if (DoneAfterSimplification){
    double ResInf;
    std::cout << "Solution process aborted; infeasible constraint system detected."<<std::endl;
    if(DoneAfterSimplification==1){
      std::cout << "The universal constraint system has no solution. The existential constraint system might be feasible."<< std::endl;
      ResInf=-((int64_t)1<<61)/1.5;
    }
    else{
      std::cout << "The existential constraint system has no solution. The universal constraint system might be feasible."<< std::endl;
      ResInf=((int64_t)1<<61);
    }
    if (yasol.objInverted) ResInf *= -1;
    std::cout << "RESULT: "<< ResInf  << std::endl;
    std::cout << "NODES: 0, #RELAXATIONS: 0";
    std::cout << ", LEARNED: 0" << std::endl;
    std::cout << "TIME: 0" << std::endl;
    delete yasolPt;
    return 0;
  }

  yasol.ySetProcessNo(myrank);

  if (myrank % 2 == 1) {
    ini_time = time(NULL);
    result = yasol.ySolve(ini_time);
    MPI_Finalize();
    delete yasolPt;
    return 0;
  }

  if(argc>2 &&(string)argv[2]=="Reduce"){
    yasol.Reduce(in);
    cerr << "created reduced QIP from QIPID " <<endl;
    delete yasolPt;
    return 0;
  }


  //char pvsol[] = "00000100000000000010000000000000010000000000000000001000000000000010001111000100000100000000000010000000001111101000000010000000000000000001000000000000001000000000000011210000000020204000";
  //char pvsol[] = "1000100001100001110010001000000000001010001000000001110000000100000000000000000000470";
  //char pvsol[] = "1000000000001000000000001000000000010000000000000100000000001000000000010000000000001000000000010001111000000000100000000000100000000001000000000100000000010011110000000000000000100000000010000000000001000000000000100000000100000000000000000000001101011110011110012020000200022020020";
  //char pvsol[] = "1000000000001000000000001000000000010000000000000100000000001000000000010000000000000100000000010001110110000000100000000000100000000001000000000001000000011100001100000000000000100000000000100000000100000000000001000000000001000000000000000000001101011110000001102020002000200202200";
  //char pvsol[] = "1000000000001000000000001000000000010000000000000100000000001000000000010000000000001000000000010001111000000000100000000000100000000001000000000100000000010011110000000000000000100000000010000000000001000000000000100000000100000000000000000000001101011110001010012020000200022020020";

  //char pvsol[] = "11000001001000011000000000000000101000000000001000101000000000010000010000000000000000000";

  //vor mzzv42:
  char pvsol[] = "11111111111111111111111111111111011111011100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000110000000000000011000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000100000100000000000000000000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000100000000000000000000000001000000000000000000000000000000000000000101000000000000000000000000000000000000000000000001100000000000000010000000001111011110101001000110100001001111101000110100001001111101010000100101110001101010000100101110001101100110001111011111010011010101101010010000100010111001011010000011010000101000101001010010100011010000100010101111010111101111101001101001110111010110100111011011011011011011011010001010001100101010011100011010011010111010011010110110101101011010110100010000001100001111011101111010000000001010001010001010001111000000000000000001101010000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000010100000000000000000000000000000000000000000000000000000000000010101000010000000000000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000110101000000000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000001010000000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000001010000000000110000000000000000000000000000000000000000111010101010101010000000000111100000000000000000000000000000000000000000000000000000000110100100000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010010000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010100000000000000000000000000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000101100010000000000000000000000000000000000000000000000000000000000000000010101000000000000000000000000111000000000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000010100000000000000000000000000000000000000000000000000000000100100000000000000000000000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000111000000000000000000000000000000001010010000000000000000000000000001110000000000000000000000001100000000000000000000000000011010100000000000000000000000011000000000000000000000000000110101000000000000000000000011100000000000000000000100100000000000000000000000000000000001010000000000000000000101010000100000000000000000000000000010100000000000000000001010100001000000000000000000000000000000000000000000000000000000000000000000000000000100100000000000000000000000000010100000000000000000000000000000000000000000000000010100000000000000000000110000000000000010000000000000001100000000000000000101000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010001000100100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000100010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000010010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100000000000000000000000000000000000000000000000000000000000001100000000000000000000001110000000000000000000000000000000000000000000000000000000000000000000000000000000000010010010000100001000010000100001000010001000100001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010000000000000000000000000000000000000000000000000000000000000000000000000000000001010000000000000000000000000000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000001100000000000000000000000000000000000111000000000000000000010000000000000000000000000000011000000000000000000000000000000000010100000000000000000000100000000000000000000000000000000000000000000000001000100000000000000000000000000000000000000000000000000000000001010000000000000000000000000000000010000000000000000000000001010000000100000101000000010000010100000001000001010000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010101010101001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000010100000000000000000000000000000000000000000000100100000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010010000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100101000000010000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101010000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011000100001000100010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101000000000000000000000000000000000000000000100100000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000100000000000010010010010010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001100000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010100000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101000000000000000000000000000000000000000100000000000011101010011110111000001001100000";

  // vor mzzv11.qlp
  //char pvsol[] = "111011111111111111111001111000110111111110111000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000011000000000000000000000000000000000000010100000010000000000000000000000000000000000000000000000000001000000000001000000000000000000000001000000000011100001000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000001000000000000010000000000000000000000000100010000000000100001000000000000000100000011110011110001010000011001000110100001001111101000110100001001111101010000100101110001011010000100101110001100000000000001111001100000011100000000000000000100010011100000001000000100101010101000010100001000001100001000100001010010010000001111010111101110000001000011101001101001110111010110100111011011011011011011010000000000001100111010001011111010100000000000000000010111101110000010111100101000001011101111001101111010010000001010011010011010010000000000000000000000000000000000000000000000000000000001000000000000010000000100000010000100000100000100000101000000000100000000100000100000100000100000100000100000001000010001000001000111000000000000000000000000000000000000000000000000000000000000000000000000000001010000000000000000000000000001000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000001010010000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000011000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000100000010000000010000100010010000000000000000000000000000000000000000000000000000010000000010000001000000010000000000000000000100100000000000000000000000000000000000000000000000000000000100000000000000000000001101010010001000000000000000000000000001110000000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000001000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000011000100100000000000000000000000000000000000000110000000000000011100000000000000000000000000000000000000000000000100100000000000000000000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010010000000000000000000000000000000000000000000101000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000110000000000000000001100000000000000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000001000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000100100000000000000000000000000000010000000000000000000000000000010010000000000000000000000010000000000000000000000000011000000000000000000000011000000000000000000000000000001010001000000000000000001010000000000000000000000010010000000000000000110000000000000000000000000000001010000000000000000001000000000000000000000000000101100000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010100100001000010010000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000010100000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101000000010000010100000001000000000000000000000101000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000110000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100100100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000010000000000000000000000001000000000000000000000000000000000000000000000000000000000000010000000000000010100000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000011000000100000000000000101010101100000000000000000000000000000000000000000000000000000000000000000000010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001001000000000000000000000000000000000000000000000000000000000000000000000000000000000000010100000000000000000000000011110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001100000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010000000000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000100000000000000001110001101110110000110000010101111000001011100101101111000001011100101101110000000110001";

  std::vector<data::QpNum> solu;
  if(0)for (int i = 0; i < strlen(pvsol);i++)
    solu.push_back((double)((int)(pvsol[i]-'0')));
  //yasol.saveDepSolution(solu);

  const int DEPfirst=0;
  if (DEPfirst) {
    cout << "Solving DEP..." << endl;
    algorithm::Algorithm::QlpSolution sol = yasol.solveDEP(true);

    cout << "DEP Solution: " << sol.getSolutionStatusString() << endl;
    cout << "DEP Objective Value: " << sol.getObjFunctionValue() << endl;
    cout << "DEP Vars: "
	 << data::QpNum::vecToString(sol.getSolutionVector()) << endl;
    std::vector<data::QpNum> solu = sol.getSolutionVector();
    yasol.saveDepSolution(solu);
  }

  ini_time = time(NULL);
  clock_t start, end;
  start = clock();
  bool useInteractiveMode=false;
  if (argc > 2 && argv[argc-1][0] == 'i') {
    useInteractiveMode=true;
  }
  if (argc > 3) {
    yasol.setTimeout(time(NULL) + atoi(argv[3]));
  }
  if (argc > 3 && yasol.getTimeout() <= time(NULL)) {
    std::cout << "RESULT: " << "timeout" << " : " << in << std::endl;
    std::cout << "TIME: " << time(NULL)-ini_time << std::endl;
  } else if (yasol.getInfoLevel() > -10) {
    //cerr << "Objective Shift = " << yasol.offset_shift << endl;
    result = yasol.ySolve(ini_time);
	  
    if (yasol.getInfoLevel() > 0) {
      if (yasol.getInfoLevel() >= 2) std::cout << "Und LOS #rows=" << yasol.getmRows() << " #cols=" << yasol.getnVars() << std::endl;
      if (yasol.getInfoLevel() >= 2) std::cout << "Objective Shift = " << yasol.offset_shift << endl;
      if (yasol.objInverted) std::cout << "RESULT: " << -result-yasol.qbp->getFinalOffset() << " : " << in << std::endl;
      else std::cout << "RESULT: " << result+yasol.qbp->getFinalOffset() << " : " << in << std::endl;
      std::cout << "FINAL NODES: " << yasol.getNumberOfDecisions()+yasol.getNumberOfPropagationSteps() << ", #RELAXATIONS:"<< yasol.getNumberOfQlpCalls();
      std::cout << ", LEARNED: " << yasol.getNumberOfLearntConstraints() << std::endl;
      double time_taken = double(clock() - start) / double(CLOCKS_PER_SEC);
      std::cout << "TIME: " << time_taken << std::endl;
      yasol.qbp->WriteSolutionFile(+result+yasol.qbp->getFinalOffset(),time_taken, "OPTIMAL");
    } else {
      cerr << "result=" << result << " yasol.getNinf() = " << yasol.getNinf() << endl;
      if (yasol.getNinf() == result || yasol.getNinf() == -result) cout << "0" << endl;
      else {
	cout << "1" << endl << endl;
	cout << result << endl << endl;
	cout << "0" << endl;
      }
    }
    if (useInteractiveMode) {
      char input[1000];
      bool finished=false;
      while (!finished) {
	fgets(input,999,stdin);
	if (!strncmp(input,"quit",4)) {
	  cerr << "info quit" << endl;
	  finished = true;
	} else if (!strncmp(input,"get nodeinfo ",13)) {
	  int nodeID = atoi(&input[13]);
	  cerr << "info get nodeinfo " << nodeID << endl;
	  yasol.write_nodeinfo(nodeID);
	} else if (!strncmp(input,"get successors ",15)) {
	  int nodeID = atoi(&input[15]);
	  cerr << "info get successors of node " << nodeID << endl;
	  yasol.write_successors(nodeID);
	} else if (!strncmp(input,"get varname ",12)) {
	  int v = atoi(&input[12]);
	  yasol.writeRealName(v);
	} else if (!strncmp(input,"update node ",12)) {
	  int v = atoi(&input[12]);
	  yasol.updateNode(v);
	}
      }
    }
  }
    
  if (yasol.getInfoLevel() > 5 || yasol.getInfoLevel() < -5) {
    ini_time = time(NULL);
    cerr << "Solving DEP..." << endl;
    if (yasol.getInfoLevel() > -1000) {
      if (yasol.getInfoLevel() > -50) {
	algorithm::Algorithm::QlpSolution sol = yasol.solveDEP();
	cout << "DEP Solution: " << sol.getSolutionStatusString() << endl;
	cout << "DEP Objective Value: " << sol.getObjFunctionValue() << endl;
	cout << "DEP Vars: " << data::QpNum::vecToString(sol.getSolutionVector()) << endl;
	std::cout << "RESULT: " << sol.getObjFunctionValue().asDouble() << " : " << in << std::endl;
	std::cout << "TIME: " << time(NULL) - ini_time << std::endl;
      } else {
	algorithm::Algorithm::QlpSolution sol = yasol.solveDEP();
	if (sol.getSolutionStatusString().compare("Feasible")) {
	  cout << "1" << endl << endl;
	  cout << sol.getObjFunctionValue() << endl << endl;
	  cout << "0" << endl;
	} else {
	  cout << "0" << endl;
	}
      }
    } else {
      yasol.dummyDEP();
      std::cout << "RESULT: " << " no result" << " : " << in << std::endl;
      std::cout << "TIME: " << time(NULL) - ini_time << std::endl;
    }
  }
  MPI_Finalize();
  delete yasolPt;
  return 0;
}

